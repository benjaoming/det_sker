<%= simple_form_for @event, html: { multipart: true, name: 'createForm' } do |f| %>


    <%= f.input :title %>
    <%= f.input :cancelled if @event.persisted? %>

<div class="create-form__row">
    <%= f.label :picture, class: 'create-form__label' %>
    <div>
    <label id="js_button_text" class="create-form__file" for="event_picture">
        <%# show the filename in the button if there is a file %>
        <% if @event.picture.present? %>
            <%= @event.picture.original_filename %>
        <% else %>
            <%= t '.choose_file' %>
        <% end %>
    </label>
      <%= f.input :picture, label: false %>
    <%= bootstrap_glyphicon('trash', 'btn btn-default') if @event.picture.present? %>
    <input type="hidden" name="remove_picture" id="event_remove_picture"/>
    <%= f.hint t('.picture.warning'), class: 'create-form__info', data: { role: 'picture_warning' } %>
    </div>
</div>

<%= f.input :short_description %>
<%= f.association :categories, label_method: ->(obj){ obj.send(t(:language)).titleize }, required: true,
    input_html: { class: 'selectpicker', title: t('.choose_category'), name: 'selectList' },
    wrapper_html: { class: 'create-form__select-list' }
%>
<label class="create-form__label">
    <%= t 'events.form.new_location_title' %>
    <input list="locations" name="location" class="create-form__input"/>
</label>
    <datalist id="locations">
    <% Location.all.each do |loc| %>
        <%= content_tag(:option, loc.name, value: loc.id) %>
    <% end %>
    </datalist>
        <%= link_to new_location_path, class: 'btn btn-default btn-sm pull-right',
        data: {
          remote: true,
          toggle: 'modal',
          target: 'remote_form_modal',
          update_val: '#location-typeahead',
          update_field: 'event[location_id]',
          modal_title: t('.new_location_title')
        } do %>
            <%= t('.create_location') %>
        <% end %>



    <%# This dialog is only for new events %>
    <% unless @event.persisted? %>
      <div id='check_recurring' class="checkbox">
        <label class='create-form__label'>
          <%= check_box_tag :recurring, 'yes', false,
          data: { function: 'show', target: '#repeating_control', hide: '#standard_time_control' }
          %>
          <%= t '.repeating_event' %>
        </label>
      </div>

      <div id="repeating_control" class='create-form__row' style="display: none;">
        <h2><%= t 'event_series.form.repetition_header' %></h2>
        <%= f.simple_fields_for :event_series do |s| %>
         <%= render partial: 'event_series/repeating_control', locals: { builder: s,  coming_events: false } %>
        <% end %>
      </div>
    <% end %>


      <%= f.input :start_time, start_year: Date.today.year, end_year: Date.today.year + 1, minute_step: 15 %>
      <%= f.input :end_time, start_year: Date.today.year, end_year: Date.today.year + 1, minute_step: 15 %>

      <%= f.input :link, as: :url %>

    <%# event price field should only be shown a) if there is already a price
    or b) if the user has checked this box to say that there is a price
    Note the javascript hooks on the data elements. %>
    <div class="create-form__row">
    <% if @event.price.blank? %>
        <input id="priceCheck" name="event[price_enabled]" value="1" type="checkbox"
        data-function="show" data-target=".event_price">
        <label><%= t '.enable_price' %></label>
    <% end %>
    <% visibility =  @event.price.present? ? 'block' : 'none' %>
    <div>
        <input class="create-form__input" style="display: <%= visibility %>;" placeholder="Hvor meget koster det?" name="event[price]" id="priceInput" type="text">
    </div>
    </div>

    <% if current_user.is_admin? %>
        <div class="input boolean optional checkbox">
            <label class="create-form__label" for="event_featured">
                <%= f.input_field :featured, boolean_style: :inline, class: 'checkbox no-form-control' %>
                <%= t '.feature_event?' %>
            </label>
        </div>
    <% end %>

    <div class="create-form__row">
        <%= f.input_field :comments_enabled, boolean_style: :inline, class: 'checkbox no-form-control' %>
        <%= label_tag t('simple_form.labels.defaults.comments_enabled') %>
    </div>
    <div class="create-form__row">
      <label class="create-form__label" for="event_published">
        <%= f.input_field :published, boolean_style: :inline, class: 'checkbox no-form-control' %>
        <%= t 'simple_form.labels.defaults.published' %>
      </label>
      <span class="text-info">
        <%= t('simple_form.labels.defaults.published_help') %>
      </span>
    </div>
    <br/>
    <div class="create-form__row">
      <div class="col-xs-12">
        <%= f.button :submit, class: '' %>
      </div>
    </div>
    <br/>
    <% end %>
    <%= render partial: 'layouts/modal_wrapper' %>
    <%= render partial: 'form_js' %>
